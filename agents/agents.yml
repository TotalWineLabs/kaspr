
# An agent is a distributed system processing the events in a stream.

agents: 

 - name: items-reformat
   description: Filters and reformats upstream items to fusion schema.

   inputs:
      topics:
        - name: orders
          auto_create: True
          key_serializer: raw|json|pickle|binary
          value_serializer: raw|json|pickle|binary
          config:
            partitions: 1
            cleanup.policy: delete
            retention.ms: 604800000


   # Define a list of data processing units such as filters, transformations, or custom logic. 
   # Each processor has its configuration and the type determines the processing logic.
   processors:

    - name: selectNewItems
      filter:
        match:
          - exact:
              $in.value.object.type: "ITEM"
              $in.value.object.version: 1
          - regex:
              $in.value.object.type: "^(BRAND|PRODUCT)$"
        python:
          expression: |
            event.value.object.type == "ITEM"

    - name: flatten
      map:
        $out.key: $in.value.object.id
        $out.value: $in.value.*

   # Defines the output destinations for processed data.
   outputs:

      - type: topic
        topic: items-by-name
        